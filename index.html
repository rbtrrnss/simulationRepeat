<!DOCTYPE html>
<html>
<head>
<title>simulationRepeat</title>

<! created by Alexander Zintler
2019-09-17: 1.0 initial version
2019-11-25: 2.1 side by side view, input fields for file names
2022-01-13: 3.0 scale bar was added, set resolution in top left
2026-02-04: 4.0 drag and drop functionality added, left div position adjusted
!>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<style type="text/css">
body {
background-color: #2b2b2b;
background-image: url("img_ABF.jpg");
image-rendering: crisp-edges;
image-rendering: pixelated;
}
#left-container {
left: -1px; top: -1px; right: 5px;
position: absolute;
height: 100%;
width: calc(50% - 200px);
resize: horizontal;
overflow: hidden;
z-index: 2;
display: flex;
padding: 0;
margin: 0;
gap: 0;
column-gap: 0;
}
#left-container::after {
content: '';
position: absolute;
right: 0;
bottom: 0;
width: 0;
height: 0;
border-left: 14px solid transparent;
border-top: 14px solid transparent;
border-right: 14px solid #39ff14;
border-bottom: 14px solid #39ff14;
pointer-events: none;
}
#left {
background-color: #2b2b2b;
background-image: url("img_HAADF.jpg");
background-attachment: fixed;
position: relative;
height: 100%;
left: -1px; right: 40px;
width: 100%;
overflow: hidden;
mix-blend-mode: normal;
image-rendering: crisp-edges;
image-rendering: pixelated;
z-index: 3;
gap: 0;
column-gap: 0;
}
#left::after {
content: '';
position: absolute;
right: 0;
bottom: 0;
width: 0;
height: 0;
border-left: 14px solid transparent;
border-top: 14px solid transparent;
border-right: 14px solid #39ff14;
border-bottom: 14px solid #39ff14;
pointer-events: none;
}
#overlap {
background-color: #2b2b2b;
background-image: url("img_HAADF.jpg");
background-attachment: fixed;
position: absolute;
left: -1px;
top: -1px;
margin-left: -2px;
height: 100%;
width: 200px;
resize: horizontal;
overflow: hidden;
mix-blend-mode: normal;
image-rendering: crisp-edges;
image-rendering: pixelated;
z-index: 2;
}
#overlap::after {
content: '';
position: absolute;
right: 0;
bottom: 0;
width: 0;
height: 0;
border-left: 14px solid transparent;
border-top: 14px solid transparent;
border-right: 14px solid #39ff14;
border-bottom: 14px solid #39ff14;
pointer-events: none;
}
#right {
right: 0px; top: 0px;
position: absolute;
height: 100%;
width: 100%;
z-index: 1;
}
div.buttonleft {
position: absolute;
left: 1%; top: 10px;
background-color: #f0f0f0;
padding: 5px 5px;
border-radius: 4px;
z-index: 3;
}
div.buttonright {
position: absolute;
left: 51%; top: 10px;
background-color: #f0f0f0;
padding: 5px 5px;
border-radius: 4px;
z-index: 3;
}
#scaleleft {
position: absolute;
left: 1%; bottom: 10px;
background-color: #ffffff;
/* If simulation was at 10 pm per px */
width: 100px; 
height: 10px;
border-color:#000000;
border-style:solid;
border-width:1px;
z-index: 3;
}
#scaleright {
position: absolute;
right: 1%; bottom: 10px;
background-color: #ffffff;
/* If simulation was at 10 pm per px */
width: 100px; 
height: 10px;
border-color:#000000;
border-style:solid;
border-width:1px;
z-index: 3;
}
p {
font-family:Arial;
text-align:center;
margin-top: -20px;
color: white;
background-color: #00000070;
}
</style>

<script  type="text/javascript">
    function showl() {
        $('#left').css('background-image', 'url("' + $('#ImageUrlLeft').val() + '")');
    }
    function showb() {
        $('body').css('background-image', 'url("' + $('#ImageUrlBack').val() + '")');
    }
	function updatescale() {
		$('#scaleleft').css('width', 1000/$('#pmperpx').val() + 'px' );
		$('#scaleright').css('width', 1000/$('#pmperpx').val() + 'px' );
		}
	function updateblend() {
		$('#overlap').css('mix-blend-mode', $('#blendmode').val() );
		}
	function switchsides() {
		var urlleft = $('#left').css('background-image');
		var leftfilename = $('#ImageUrlLeft').val();
		var urlright = $('body').css('background-image');
		var rightfilename = $('#ImageUrlBack').val();
		$('body').css('background-image', urlleft);
		$('#ImageUrlBack').val(leftfilename);
		$('#left').css('background-image', urlright);
		$('#ImageUrlLeft').val(rightfilename);
		}

    // Drag and Drop functionality
    function setupDragAndDrop() {
        const leftDiv = document.getElementById('left');
        const rightDiv = document.getElementById('right');
        
        // Enable pointer events on right div for drag operations
        rightDiv.style.pointerEvents = 'auto';
        
        // Prevent default browser behavior for entire document
        document.addEventListener('dragover', e => e.preventDefault());
        document.addEventListener('drop', e => e.preventDefault());
        
        // Setup drop zones for both divs
        [leftDiv, rightDiv].forEach(zone => {
            zone.addEventListener('dragover', e => {
                e.preventDefault();
                e.stopPropagation();
                zone.style.boxShadow = 'inset 0 0 120px rgba(100, 150, 255, 0.7)';
            });
            
            zone.addEventListener('dragleave', e => {
                e.preventDefault();
                e.stopPropagation();
                zone.style.boxShadow = 'none';
            });
            
            zone.addEventListener('drop', e => {
                e.preventDefault();
                e.stopPropagation();
                zone.style.boxShadow = 'none';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        
                        reader.onload = function(event) {
                            const imageUrl = event.target.result;
                            
                            if (zone === leftDiv) {
                                $('#left').css('background-image', 'url("' + imageUrl + '")');
								$('#overlap').css('background-image', 'url("' + imageUrl + '")');
                                $('#ImageUrlLeft').val(file.name);
                            } else {
                                $('body').css('background-image', 'url("' + imageUrl + '")');
                                $('#ImageUrlBack').val(file.name);
                            }
                        };
                        
                        reader.readAsDataURL(file);
                    } else {
                        alert('Please drop an image file');
                    }
                }
            });
        });
    }

    // Initialize drag and drop when page loads
    $(document).ready(function() {
        setupDragAndDrop();
        
        // Track #left-container resize and update #overlap position
        const container = document.getElementById('left-container');
        const overlap = document.getElementById('overlap');
        
        function updateOverlapPosition() {
            overlap.style.left = container.offsetWidth + 'px';
        }
        
        // Update on initial load
        updateOverlapPosition();
        
        // Track resize using ResizeObserver
        const observer = new ResizeObserver(updateOverlapPosition);
        observer.observe(container);
    });
</script>
</head>

<body>
<div id="left-container">
    <div id="left"></div>
</div>
<div id="overlap"></div>
<div id="right"></div>
<div class="buttonleft">
<span>left </span><input id="ImageUrlLeft" size="48" value="img_HAADF.jpg" /> <!-- the textbox can get the user input Url of Image-->
<input type="button" value="Go" onclick="showl()" /> <!-- the GO button --><br>

&nbsp &nbsp &nbsp <input id="pmperpx" size="1" value="10" /> pm/px
<input type="button" value="update scale" onclick="updatescale()" /> &nbsp 
<label for="blendmode">blend mode: </label>
<select id="blendmode" name="blendmode" onchange="updateblend()">
  <option value="normal">normal</option>
  <option value="multiply">multiply</option>
  <option value="lighten">lighten</option>
  <option value="overlay">overlay</option>
  <option value="difference">difference</option>
</select> &nbsp &nbsp
<input type="button" value="<->" onclick="switchsides()" /> 

</div>

<div id="scaleleft"><p>1 nm</p></div>

<div class="buttonright">
<span>right </span><input id="ImageUrlBack" size="48" value="img_ABF.jpg" /> <!-- the textbox can get the user input Url of Image-->
<input type="button" value="Go" onclick="showb()" /> <!-- the GO button --></div>

<div id="scaleright"><p>1 nm</p></div>
</html>
